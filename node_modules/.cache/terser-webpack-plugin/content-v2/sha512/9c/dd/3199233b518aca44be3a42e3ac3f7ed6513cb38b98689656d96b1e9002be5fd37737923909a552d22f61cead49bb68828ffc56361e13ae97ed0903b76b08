{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{504:function(s,t,a){\"use strict\";a.r(t);var e=a(18),r=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":s.$parent.slotKey}},[a(\"h1\",{attrs:{id:\"pt-query-digest\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#pt-query-digest\"}},[s._v(\"#\")]),s._v(\" pt-query-digest\")]),s._v(\" \"),a(\"blockquote\",[a(\"p\",[s._v(\"pt-query-digest 属于 Percona Toolkit 的一个工具，也是使用较多的一个；用于分析slow log,也可以分析MySQL的 binary log 、 general log 日志。\")]),s._v(\" \"),a(\"p\",[s._v(\"本文通过pt-query-digest实现慢sql的分析，优化sql\")])]),s._v(\" \"),a(\"h3\",{attrs:{id:\"一-安装percona-toolkit\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#一-安装percona-toolkit\"}},[s._v(\"#\")]),s._v(\" 一，安装percona-toolkit\")]),s._v(\" \"),a(\"p\",[s._v(\"下载:https://www.percona.com/doc/percona-toolkit/2.2/installation.html\")]),s._v(\" \"),a(\"p\",[s._v(\"安装在/usr/local/percona-toolkit目录下\")]),s._v(\" \"),a(\"div\",{staticClass:\"language-linux extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[a(\"code\",[s._v(\"wget percona.com/get/percona-toolkit.tar.gz\\ntar zxf percona-toolkit.tar.gz\\ncd percona-toolkit-3.3.1/\\nperl Makefile.PL PREFIX=/usr/local/percona-toolkit\\nmake && make install\\n\")])])]),a(\"ol\",[a(\"li\",[a(\"p\",[s._v(\"MySQL开启慢查询日志并设置慢查询时间\")]),s._v(\" \"),a(\"div\",{staticClass:\"language- extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[a(\"code\",[s._v(\"mysql> show variables like '%slow_query_log%';\\n+---------------------------+-------------------------------+\\n| Variable_name             | Value                         |\\n+---------------------------+-------------------------------+\\n| slow_query_log            | ON                            |\\n| slow_query_log_file       | /var/lib/mysql/mysql-slow.log |\\n+---------------------------+-------------------------------+\\n\")])])]),a(\"div\",{staticClass:\"language-Linux extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[a(\"code\",[s._v(\"-- 超过一秒的记录到日志中\\nmysql>  set global long_query_time=1;\\n\")])])]),a(\"p\",[s._v(\"开启慢查询之后，在程序运行一段时间之后，可以拿到记录的日志\")])]),s._v(\" \"),a(\"li\",[a(\"p\",[s._v(\"使用命令直接分析慢查询日志\")]),s._v(\" \"),a(\"p\",[s._v(\"直接拿到的mysql-slow.log看着没有条理，不容易分析\")]),s._v(\" \"),a(\"p\",[s._v(\"使用命令分析并生成slow_report.log ：  \"),a(\"code\",[s._v(\"pt-query-digest slow.log > slow_report.log\")])]),s._v(\" \"),a(\"p\",[s._v(\"然后我们可以导出这个文件，查看其中内容\")])])]),s._v(\" \"),a(\"h3\",{attrs:{id:\"二-分析慢查询日志\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#二-分析慢查询日志\"}},[s._v(\"#\")]),s._v(\" 二，分析慢查询日志\")]),s._v(\" \"),a(\"p\",[s._v(\"文件中总共包含三部分：总体统计，sql统计，单个sql的统计\")]),s._v(\" \"),a(\"h5\",{attrs:{id:\"_1-总体统计\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_1-总体统计\"}},[s._v(\"#\")]),s._v(\" 1. 总体统计\")]),s._v(\" \"),a(\"div\",{staticClass:\"language-java extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-java\"}},[a(\"code\",[s._v(\"# \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"85.8\")]),s._v(\"s user time\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"990\")]),s._v(\"ms system time\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"30.71\")]),s._v(\"M rss\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"193.21\")]),s._v(\"M vsz\\n# \"),a(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"Current\")]),s._v(\" date\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"Mon\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"May\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"10\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"11\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"47\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"39\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2021\")]),s._v(\"\\n# \"),a(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"Hostname\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),s._v(\" xxxx\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"xxx\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"-\")]),s._v(\"xxx\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"com\\n# \"),a(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"Files\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"/\")]),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"var\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"/\")]),s._v(\"lib\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"/\")]),s._v(\"mysql\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"/\")]),s._v(\"mysql\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"-\")]),s._v(\"slow\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"log\\n# \"),a(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"Overall\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"87.23\")]),s._v(\"k total\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"73\")]),s._v(\" unique\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0.05\")]),s._v(\" QPS\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0.37\")]),s._v(\"x concurrency __________\\n# \"),a(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"Time\")]),s._v(\" range\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2021\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"-\")]),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"04\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"-\")]),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"16\")]),s._v(\"T03\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"15\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"31\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"to\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2021\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"-\")]),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"05\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"-\")]),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"07\")]),s._v(\"T08\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"38\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"15\")]),s._v(\"\\n\\n# 属性            总计       最小    最大    平均      \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"95\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"%\")]),s._v(\"  标准     中等\\n\\n# \"),a(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"Attribute\")]),s._v(\"       total     min     max     avg     \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"95\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"%\")]),s._v(\"  stddev  median\\n# \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),s._v(\"    \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\"\\n# \"),a(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"Exec\")]),s._v(\" time       \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"676605\")]),s._v(\"s    \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),s._v(\"s    \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"905\")]),s._v(\"s      \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"8\")]),s._v(\"s     \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"23\")]),s._v(\"s     \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"12\")]),s._v(\"s      \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"4\")]),s._v(\"s\\n# \"),a(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"Lock\")]),s._v(\" time       \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"242\")]),s._v(\"s       \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0\")]),s._v(\"      \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\"s     \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"3\")]),s._v(\"ms     \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"4\")]),s._v(\"ms    \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"17\")]),s._v(\"ms   \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"839\")]),s._v(\"us\\n# \"),a(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"Rows\")]),s._v(\" sent       \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"8.90\")]),s._v(\"M       \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0\")]),s._v(\"  \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"15.53\")]),s._v(\"k  \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"107.02\")]),s._v(\"  \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"400.73\")]),s._v(\"  \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"616.06\")]),s._v(\"    \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"8.91\")]),s._v(\"\\n# \"),a(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"Rows\")]),s._v(\" examine    \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"7.13\")]),s._v(\"G       \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0\")]),s._v(\"   \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"8.94\")]),s._v(\"M  \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"85.77\")]),s._v(\"k  \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"46.68\")]),s._v(\"k \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"412.27\")]),s._v(\"k   \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2.38\")]),s._v(\"k\\n# \"),a(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"Query\")]),s._v(\" size      \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"161.99\")]),s._v(\"M     \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"6\")]),s._v(\"  \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"24.91\")]),s._v(\"k   \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1.90\")]),s._v(\"k   \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1.96\")]),s._v(\"k  \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"682.67\")]),s._v(\"   \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1.96\")]),s._v(\"k\\n\")])])]),a(\"h5\",{attrs:{id:\"_2-sql统计汇总\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-sql统计汇总\"}},[s._v(\"#\")]),s._v(\" 2. sql统计汇总\")]),s._v(\" \"),a(\"div\",{staticClass:\"language-java extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-java\"}},[a(\"code\",[s._v(\"# \"),a(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"Profile\")]),s._v(\"\\n# \"),a(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"Rank\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"Query\")]),s._v(\" ID                            \"),a(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"Response\")]),s._v(\" time    \"),a(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"Calls\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"R\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"/\")]),a(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"Call\")]),s._v(\"  \\n# \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"==\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\" \\n#    \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0x8EBD7078F62A82A7C578540C76F46BC4\")]),s._v(\"  \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"602766.9262\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"8.\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"75091\")]),s._v(\"  \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"8.0272\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"13.94\")]),s._v(\" SELECT xxxx\\n#    \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0x40A63F5C50A2324033DB9FCAA2719C4E\")]),s._v(\"  \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"18044.3571\")]),s._v(\"  \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2.7\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"%\")]),s._v(\"  \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"4131\")]),s._v(\"  \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"4.3680\")]),s._v(\"  \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"3.07\")]),s._v(\" SELECT xxxx\\n#    \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"3\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0xFB8F32AE0EFAA83C665B91B6E5862D2F\")]),s._v(\"  \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"16215.4058\")]),s._v(\"  \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2.4\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"%\")]),s._v(\"  \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2335\")]),s._v(\"  \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"6.9445\")]),s._v(\"  \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"6.22\")]),s._v(\" SELECT xxxx \\n#    \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"4\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0x2CF3802FA98AFCE8DA5C85F6E8424DCE\")]),s._v(\"  \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"12951.3375\")]),s._v(\"  \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1.9\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"%\")]),s._v(\"  \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2390\")]),s._v(\"  \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"5.4190\")]),s._v(\"  \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"6.56\")]),s._v(\" SELECT xxxx\\n#    \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"5\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0x56A24EC2EC1FFDB2F49A123C34D5E0BD\")]),s._v(\"   \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"8612.3662\")]),s._v(\"  \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1.3\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"%\")]),s._v(\"   \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"479\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"17.9799\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"31.\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\" SELECT xxxx\\n#    \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"6\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0x6D73ABA4D5097101273AA5ADB2259759\")]),s._v(\"   \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"8328.1423\")]),s._v(\"  \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1.2\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"%\")]),s._v(\"   \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"858\")]),s._v(\"  \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"9.7065\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"12.72\")]),s._v(\" SELECT xxxx\\n#    \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"7\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0x75A04B6CA2CBDE5EB7A27A7FC15FFCC1\")]),s._v(\"   \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"3864.3549\")]),s._v(\"  \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0.6\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"%\")]),s._v(\"   \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"615\")]),s._v(\"  \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"6.2835\")]),s._v(\"  \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"5.72\")]),s._v(\" SELECT xxxx\\n#    \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"8\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0x886F3B1A59BD9900A6688314B0A3E4E0\")]),s._v(\"   \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"3050.7563\")]),s._v(\"  \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0.5\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"%\")]),s._v(\"   \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"614\")]),s._v(\"  \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"4.9687\")]),s._v(\"  \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2.93\")]),s._v(\" SELECT xxxx\\n#    \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"9\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0xE6AA1C4FE828263924B7C26F5160BD60\")]),s._v(\"    \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"680.7256\")]),s._v(\"  \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0.1\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"%\")]),s._v(\"   \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"171\")]),s._v(\"  \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"3.9809\")]),s._v(\"  \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1.06\")]),s._v(\" SELECT xxxx\\n#    \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"10\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"\\n\")])])]),a(\"div\",{staticClass:\"language- extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[a(\"code\",[s._v(\"Rank: 排名\\nQuery ID: 语句ID（去掉多余空格和文本字符，计算hash值）\\nResponse time: 总的响应时间和 该查询在本次分析中总的时间占比\\nCalls: 执行次数\\nR/Call: 平均每次执行的响应时间\\n\")])])]),a(\"h5\",{attrs:{id:\"_3-单个sql的统计\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_3-单个sql的统计\"}},[s._v(\"#\")]),s._v(\" 3. 单个sql的统计\")]),s._v(\" \"),a(\"div\",{staticClass:\"language-sql extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-sql\"}},[a(\"code\",[a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# Query 1: 0.04 QPS, 0.33x concurrency, ID 0x8EBD7078F62A82A7C578540C76F46BC4 at byte 66396962\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# This item is included in the report because it matches --limit.\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# Scores: V/M = 13.94\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# Time range: 2021-04-16T03:15:31 to 2021-05-07T08:38:15\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# Attribute    pct   total     min     max     avg     95%  stddev  median\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# ============ === ======= ======= ======= ======= ======= ======= =======\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# Count         86   75091\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# Exec time     89 602767s      2s    281s      8s     23s     11s      4s\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# Lock time     64    156s   352us   730ms     2ms     4ms    10ms   839us\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# Rows sent      6 554.55k       0      31    7.56   16.81    5.75    5.75\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# Rows examine   4 294.12M     110  77.33k   4.01k  10.29k   5.80k   2.38k\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# Query size    89 145.64M   1.98k   1.99k   1.99k   1.96k    0.00   1.96k\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# Tables\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# \\t设计到的表\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# EXPLAIN /*!50100 PARTITIONS*/\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#\\t\\t具体执行的sql语句\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"SELECT\")]),s._v(\"\\n\\thg\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"group_id\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\"\\n\\t\"),a(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"MAX\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\" ham\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"app_message_id \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" latest_message\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\"\\n\\t\"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"COALESCE\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\" hgrf\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"last_read_message_id\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" last_read_message_id\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\"\\n\\t\"),a(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"SUM\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"\\n\\t\"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"CASE\")]),s._v(\"\\n\\t\\t\\t\"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"WHEN\")]),s._v(\" app_message_id \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"COALESCE\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\" last_read_message_id\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \\n\\t\\t\\t\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"AND\")]),s._v(\" ham\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"receiver_type \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v(\"'USER'\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"THEN\")]),s._v(\"\\n\\t\\t\\t\\t\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"ELSE\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0\")]),s._v(\" \\n\\t\\t\\t\"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"END\")]),s._v(\" \\n\\t\\t\\t\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" unread_message_count \\n\\t\\t\"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"FROM\")]),s._v(\"\\n\\t\\t\\th_group hg\\n\\t\\t\\t\"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"INNER\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"JOIN\")]),s._v(\" h_message hm \"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"ON\")]),s._v(\" hm\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"group_id \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\" hg\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"group_id\\n\\t\\t\\t\"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"INNER\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"JOIN\")]),s._v(\" h_app_message ham \"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"ON\")]),s._v(\" ham\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"message_id \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\" hm\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"message_id \\n\\t\\t\\t\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"AND\")]),s._v(\" ham\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"user_id \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2084\")]),s._v(\"\\n\\t\\t\\t\"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"LEFT\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"JOIN\")]),s._v(\" h_group_read_flag hgrf \"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"ON\")]),s._v(\" hg\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"group_id \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\" hgrf\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"group_id \\n\\t\\t\\t\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"AND\")]),s._v(\" hgrf\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"user_id \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\" ham\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"user_id \\n\\t\\t\\t\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"AND\")]),s._v(\" hgrf\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"user_type \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0\")]),s._v(\" \\n\\t\\t\"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"WHERE\")]),s._v(\"\\n\\t\\t\\tham\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"deleted \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0\")]),s._v(\" \\n\\t\\t\\t\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"AND\")]),s._v(\" hm\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"send_flag \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\" \\n\\t\\t\"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"GROUP\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"BY\")]),s._v(\"\\n\\t\\thg\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"group_id\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\"\\n\\thgrf\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"last_read_message_id\\n\")])])]),a(\"p\",[s._v(\"通过以上日志我们可以看出哪些sql执行较慢，哪些sql执行次数较多，然后根据不同的业务需求去分析有问题的sql进行优化，例如：\")]),s._v(\" \"),a(\"p\",[s._v(\"对于执行慢的sql:\")]),s._v(\" \"),a(\"ul\",[a(\"li\",[s._v(\"使用explain查询执行计划，确认索引是否正常使用\")]),s._v(\" \"),a(\"li\",[s._v(\"关联表太多，是否使用冗余字段减少没必要的表关联\")]),s._v(\" \"),a(\"li\",[s._v(\"查询条件复杂，查询数据量较多，是否可以在业务层分多次查询(有时候多次并不比一次慢)\")])]),s._v(\" \"),a(\"p\",[s._v(\"对于执行频率高的sql:\")]),s._v(\" \"),a(\"ul\",[a(\"li\",[s._v(\"数据尝试使用缓存，较少数据库的查询\")])]),s._v(\" \"),a(\"h3\",{attrs:{id:\"三-实际案例分析\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#三-实际案例分析\"}},[s._v(\"#\")]),s._v(\" 三，实际案例分析\")]),s._v(\" \"),a(\"blockquote\",[a(\"p\",[s._v(\"SQL分析：执行次数75091，总时间耗费602767s,平均单次8s，最大一次281s，最少也是2s\")])]),s._v(\" \"),a(\"p\",[s._v(\"a. \"),a(\"strong\",[s._v(\"首先根据SQL 去优化，研究很久SQL没有优化空间\")])]),s._v(\" \"),a(\"p\",[s._v(\"​    \"),a(\"em\",[s._v(\"调试很久，索引都是正常使用，时间始终在2s左右，如果某个用户未读数量大，那花费时间更长\")])]),s._v(\" \"),a(\"p\",[s._v(\"b. \"),a(\"strong\",[s._v(\"根据业务逻辑拆解SQL, 减少数据量，减少表关联\")])]),s._v(\" \"),a(\"p\",[s._v(\"场景描述和分析：\")]),s._v(\" \"),a(\"blockquote\",[a(\"p\",[s._v(\"公司每天会有不定量的推文推送到每个用户,app_message 会存储用户和消息的关联( count=消息数x用户数)\")]),s._v(\" \"),a(\"p\",[s._v(\"总共4张表：\")]),s._v(\" \"),a(\"p\",[s._v(\"app_message(用户消息关联表， 主要字段：app_message_id,message_id,user_id),数据量1千万\")]),s._v(\" \"),a(\"p\",[s._v(\"message(消息表，主要字段：message_id，group_id) 数据量近2百万\")]),s._v(\" \"),a(\"p\",[s._v(\"h_group(频道表，主要字段：group_id) 每条推文都有所属的频道，数据量较少\")]),s._v(\" \"),a(\"p\",[s._v(\"h_group_read_flag(用户频道最新已读表，主要字段：last_read_message_id，group_id,user_id) 存储用户每个频道最新已读消息记录 (last_read_message_id=app_message_id)，数据量较少\")]),s._v(\" \"),a(\"p\",[s._v(\"每次用户打开APP都会通过这4个表关联查询用户的未读数量以及最新的消息\")])]),s._v(\" \"),a(\"p\",[s._v(\"解决分析：\")]),s._v(\" \"),a(\"p\",[s._v(\"b. 1: 首先h_group 只是用来关联group_id ,可以在h_app_message 中冗余group_id字段，去掉h_group表的关联；\")]),s._v(\" \"),a(\"p\",[s._v(\"b. 2: h_message的send_flag是撤回推文是0，否则是1（没有这个关联即可去除h_message表）在撤回推文之后就把h_app_message中相关数据删除，这样h_message也可以不用使用\")]),s._v(\" \"),a(\"p\",[s._v(\"b. 3: 最后主要是h_app_message表，数量级较大，然后减少数量（将跨度较远的数据按年归档处理）\")])])}),[],!1,null,null,null);t.default=r.exports}}]);","extractedComments":[]}